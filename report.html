<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GLA360 Personal – Ataskaita</title>
  styles.css
  https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js</script>
</head>
<body>
<header class="head">
  <h1>GLA360 Personal – ataskaita</h1>
  <p class="muted">Įkelkite visų raterių *.json (įskaitant <em>self</em>). Pakoreguokite svorius, peržiūrėkite radarą, klasterius, spragas/stiprybes, komentarus ir eksportuokite.</p>
</header>

<main class="wrap">
  <section class="card">
    <input id="files" type="file" multiple accept="application/json">
    <button id="analyze">Analizuoti</button>
    <div id="aidBox" class="muted mt"></div>
  </section>

  <section class="card">
    <h2>Svorio nustatymai</h2>
    <div class="grid4">
      <label>Boss svoris (0–1)<input id="wBoss" type="number" min="0" max="1" step="0.05" value="0.30"></label>
      <label>Peers svoris<input id="wPeers" type="number" min="0" max="1" step="0.05" value="0.30"></label>
      <label>Reports svoris<input id="wReports" type="number" min="0" max="1" step="0.05" value="0.30"></label>
      <label>Others svoris<input id="wOthers" type="number" min="0" max="1" step="0.05" value="0.10"></label>
    </div>
    <p class="muted">Jei svorių suma ≠ 1, bus automatiškai perskaičiuota proporcingai.</p>
  </section>

  <section class="card">
    <h2>Santrauka</h2>
    <div id="summary"></div>
  </section>

  <section class="card">
    <h2>Radaras: Self vs Others</h2>
    <canvas id="radar"></canvas>
  </section>

  <section class="card">
    <h2>Klasterių vidurkiai</h2>
    <div id="clusters"></div>
  </section>

  <section class="card">
    <h2>Top 3 spragos ir Top 3 stiprybės</h2>
    <ol id="gaps"></ol>
    <ol id="strengths"></ol>
  </section>

  <section class="card">
    <h2>Atviri komentarai</h2>
    <ul id="comments"></ul>
  </section>

  <section class="card">
    <h2>Eksportas</h2>
    <button id="saveJson">Atsisiųsti agreguotą JSON</button>
    <button onclick="window.print()">Spausdinti / PDF</button>
  </section>
</main>

app.js</script>
<script>
let lastAgg=null;

document.getElementById('analyze').addEventListener('click', async()=>{
  const files = Array.from(document.getElementById('files').files||[]);
  if(!files.length) return alert('Pasirinkite bent vieną JSON failą.');

  const packs = [];
  for(const f of files){
    try {
      const obj = JSON.parse(await f.text());
      packs.push(GLA.unpackResponse(obj));
    } catch(e){ console.warn('Negalima nuskaityti', f.name, e); }
  }
  if(!packs.length) return alert('Nepavyko nuskaityti failų.');

  const aidSet = new Set(packs.map(p=>p.aid));
  document.getElementById('aidBox').textContent =
    aidSet.size===1 ? `Assessment ID: ${[...aidSet][0]}` :
    `Dėmesio: rasti keli AID: ${[...aidSet].join(', ')}`;

  const bank = await GLA.loadBank();
  const w = {
    boss: +document.getElementById('wBoss').value || 0.3,
    peer: +document.getElementById('wPeers').value || 0.3,
    report: +document.getElementById('wReports').value || 0.3,
    other: +document.getElementById('wOthers').value || 0.1
  };
  lastAgg = GLA.aggregate(bank, packs, w);

  document.getElementById('summary').innerHTML = GLA.renderSummary(lastAgg);
  GLA.renderRadar('radar', lastAgg);
  document.getElementById('clusters').innerHTML = GLA.renderClusters(lastAgg);
  GLA.renderStrengthsGaps(lastAgg, 'strengths', 'gaps');
  GLA.renderComments(lastAgg, 'comments');

  document.getElementById('saveJson').onclick = ()=> GLA.download(`gla360_agg_${Date.now()}.json`, JSON.stringify(lastAgg, null, 2));
});
</script>
</body>
</html>
