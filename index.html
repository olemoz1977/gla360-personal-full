<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GLA360 Personal (pilna versija) â€“ pradÄ—ti vertinimÄ…</title>
  <meta name="description" content="AsmeninÄ— 360Â° lyderystÄ—s apklausa be serverio â€“ GitHub Pages. 5 klasteriai, 15 kompetencijÅ³, 72 klausimai.">
  styles.css
</head>
<body>
<header class="head">
  <h1>GLA360 Personal â€“ <span class="badge">pilna versija</span></h1>
  <p class="muted">Sukurkite vertinimÄ…, iÅ¡siÅ³skite nuorodas vertintojams, surinkite JSON failus ir sugeneruokite ataskaitÄ… (Self vs Others, svoriai, radarai, komentarai).</p>
</header>

<main class="wrap">
  <section class="card">
    <h2>Naujas vertinimas</h2>
    <p>1) Ä®veskite savo vardÄ… ir projekto pavadinimÄ…. 2) Nurodykite, kiek rateriÅ³ kiekvienoje grupÄ—je. 3) Spauskite <strong>Sukurti</strong> â€“ gausite <em>Assessment ID</em> ir nuorodas.</p>

    <div class="grid2">
      <label>JÅ«sÅ³ vardas
        <input id="leaderName" placeholder="Vardas PavardÄ—" autocomplete="name">
      </label>
      <label>Projekto pavadinimas
        <input id="projectName" placeholder="pvz., 2025 Q4 lyderystÄ—s Ä¯sivertinimas">
      </label>
    </div>

    <div class="grid4">
      <label>Vadovas (boss)
        <input id="nBoss" type="number" min="0" step="1" value="1" inputmode="numeric">
      </label>
      <label>Kolegos (peer)
        <input id="nPeers" type="number" min="0" step="1" value="3" inputmode="numeric">
      </label>
      <label>Pavaldiniai (report)
        <input id="nReports" type="number" min="0" step="1" value="4" inputmode="numeric">
      </label>
      <label>Kiti (other)
        <input id="nOthers" type="number" min="0" step="1" value="2" inputmode="numeric">
      </label>
    </div>

    <button id="create" type="button">Sukurti vertinimÄ…</button>
    <div id="links" class="mt"></div>
  </section>

  <section class="card">
    <h2>Ataskaita</h2>
    <p>Surinkus JSON failus iÅ¡ vertintojÅ³, atidarykite report.htmlreport.html</a> ir Ä¯kelkite juos. GalÄ—site nustatyti svorius grupÄ—ms, matyti radarÄ…, klasteriÅ³ lentelÄ™, Top 3 spragas/stiprybes, komentarus ir eksportuoti Ä¯ PDF/JSON.</p>
  </section>

  <section class="card">
    <h2>Kas tai?</h2>
    <p class="muted">Å is Ä¯rankis atkartoja 360 logikÄ… (5 klasteriai, 15 kompetencijÅ³, ~72 Likert klausimai ir radarinÄ—s vizualizacijos) asmeniniam naudojimui, remiantis vieÅ¡ai apraÅ¡yta GLA360 struktÅ«ra (Global Coach Group; LEAPING KOI; MGSCC). Tai <strong>ne oficialus</strong> GLA360 produktas ar ataskaita.</p>
  </section>

  <section id="sources" class="card">
    <h2>Nuorodos</h2>
    <ul class="muted">
      <li>Global Coach Group â€“ GLA360 (apraÅ¡as, 15 kompetencijÅ³, 72 klausimai, ataskaitos logika): https://globalcoachgroup.com/gla360/globalcoachgroup.com/gla360</a></li>
      <li>LEAPING KOI â€“ metodikos santrauka (norminÄ— grupÄ—, 72 Q, 5 klasteriai): https://www.leapingkoi.com/gla360.htmlleapingkoi.com/gla360.html</a></li>
      <li>MGSCC â€“ â€From awareness to actionâ€œ (elgesiÅ³ fokusas, radaro logika): https://mgscc.net/gla360/mgscc.net/gla360</a></li>
    </ul>
  </section>
</main>

<!-- IÅ¡orinis skriptas (jei turite GLA.newAssessmentId apibrÄ—Å¾imÄ…) -->
app.js</script>

<script>
(function(){
  // Atsarginis ID generatorius, jei GLA.newAssessmentId nÄ—ra apibrÄ—Å¾tas app.js
  function fallbackId(leader, project){
    const rand = Math.random().toString(36).slice(2,10);
    const ts = new Date().toISOString().replace(/[-:TZ.]/g,'').slice(0,14);
    return `${leader.replace(/\s+/g,'_')}-${ts}-${rand}`;
  }

  const getId = (leader, project) => (window.GLA && typeof GLA.newAssessmentId === 'function')
      ? GLA.newAssessmentId(leader, project)
      : fallbackId(leader, project);

  const createBtn = document.getElementById('create');
  const linksBox = document.getElementById('links');

  createBtn.addEventListener('click', () => {
    const leader = (document.getElementById('leaderName').value || 'Lyderis').trim();
    const project = (document.getElementById('projectName').value || 'Asmeninis 360 vertinimas').trim();
    const aid = getId(leader, project);

    const n = {
      boss: Number(document.getElementById('nBoss').value) || 0,
      peer: Number(document.getElementById('nPeers').value) || 0,
      report: Number(document.getElementById('nReports').value) || 0,
      other: Number(document.getElementById('nOthers').value) || 0
    };

    const base = location.href.replace(/index\.html.*$/,'').replace(/[#?].*$/,'');
    <!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GLA360 Personal â€“ apklausa (hybrid)</title>
  <link rel="stylesheet" href="stylesng: 12px; margin: 10px 0; border: 1px solid #e5e7eb; border-radius: 8px; }
    .scale { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
    .likert input { margin-right:4px; }
    .alert.error { color:#b91c1c; background:#fee2e2; padding:8px; border-radius:6px; }
    .muted { color:#6b7280; }
    .progress { margin-bottom: 10px; }
  </style>
</head>
<body>
<header class="head">
  <h1>GLA360 Personal â€“ apklausa (hybrid)</h1>
  <p class="muted">Likerto skalÄ— 1â€“5. AID: <code id="aid">â€”</code> Â· ROLE: <code id="role">â€”</code></p>
</header>

<main class="wrap">
  <div id="surveyErrors" class="muted"></div>
  <div id="questions"></div>
  <div class="actions mt">
    <button id="finish" type="button">Baigti ir atsisiÅ³sti JSON</button>
    <button id="copy" type="button">Nukopijuoti JSON</button>
  </div>
  <p class="muted mt">Privatumas: atsakymai nesiunÄiami Ä¯ serverÄ¯; skaiÄiuojama narÅ¡yklÄ—je. Pabaigoje atsisiÅ³skite JSON ir perduokite lyderiui.</p>
</main>

<!-- 1) UÅ¾tikriname globalÄ… (jei app.js jÄ¯ pildo â€“ OK; jei ne â€“ turim fallback) -->
app.global-init.js</script>

<!-- 2) Ä®keliame tavo app.js (nebÅ«tina, bet jei turi funkcijÅ³ â€“ bus panaudotos) -->
app.js</script>

<!-- 3) Hibridinis inicializavimas su fallback -->
<script defer>
(function(){
  // ---- A. Apsauga nuo suklijuotÅ³ URL ----
  function parseQuery(){
    let raw = location.search || '';
    if (raw.includes('http')) raw = raw.split('http')[0];
    if (raw && !raw.startsWith('?')) raw = '?' + raw;
    const qs = new URLSearchParams(raw);
    const aid = (qs.get('aid') || '').trim();
    const role = (qs.get('role') || 'self').toLowerCase();
    const i = Number(qs.get('i')) || 1;
    return { aid, role, i };
  }

  // ---- B. KlausimÅ³ Ä¯kÄ—limas + cache busting ----
  async function loadQuestionsDirect(url = 'bank/questions.json'){
    const bust = `v=${Date.now()}`;
    const sep = url.includes('?') ? '&' : '?';
    try {
      const res = await fetch(`${url}${sep}${bust}`, { cache: 'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
      return await res.json();
    } catch (e) {
      console.error('âŒ Nepavyko Ä¯kelti bank/questions.json:', e);
      return null;
    }
  }

  // ---- C. Normalizacija: palaiko ir questions[], ir Competencies[].items[] ----
  function normalizeQuestions(data){
    if (!data) return [];
    if (Array.isArray(data.questions) && data.questions.length){
      return data.questions.map((q, idx) => ({
        id: q.id || `Q${idx+1}`,
        text: q.text_lt || q.text || q.stem || `Klausimas ${idx+1}`,
        cluster: q.cluster || null,
        competency: q.competency || null,
        reverse: !!q.reverse
      }));
    }
    if (Array.isArray(data.Competencies) && data.Competencies.length){
      const out = [];
      data.Competencies.forEach((comp, cIdx) => {
        const compName = comp.name || `Kompetencija ${cIdx+1}`;
        const cluster = comp.cluster || null;
        (comp.items || []).forEach((item, iIdx) => {
          out.push({
            id: item.key || `C${cIdx+1}_${iIdx+1}`,
            text: item.stem || item.text_lt || item.text || `Klausimas ${cIdx+1}.${iIdx+1}`,
            cluster,
            competency: compName,
            reverse: !!item.reverse
          });
        });
      });
      return out;
    }
    return [];
  }

  // ---- D. Rendereris (name=id, kad neliktÅ³ autofill Ä¯spÄ—jimo) ----
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function renderSurvey(questions){
    const host = document.getElementById('questions');
    if (!questions.length){
      host.innerHTML = `<div class="alert error">Nerasta Ä¯keltÅ³ klausimÅ³. Patikrink <code>bank/questions.json</code>.</div>`;
      return;
    }
    const scale = [1,2,3,4,5];
    host.innerHTML = `
      <div class="progress muted">KlausimÅ³: ${questions.length}</div>
      <div class="q-list">
        ${questions.map((q, idx) => `
          <div class="q" data-qid="${q.id}">
            <div class="stem"><strong>${idx+1}.</strong> ${escapeHtml(q.text)}</div>
            <div class="scale">
              ${scale.map(v => `
                <label class="likert">
                  <input type="radio" name="${q.id}" value="${v}" required>
                  <span>${v}</span>
                </label>
              `).join('')}
            </div>
            ${q.competency || q.cluster ? `<div class="meta muted">${q.competency ? `Kompetencija: ${escapeHtml(q.competency)}` : ''}${q.competency && q.cluster ? ' Â· ' : ''}${q.cluster ? `Klasteris: ${escapeHtml(q.cluster)}` : ''}</div>` : ''}
          </div>
        `).join('')}
      </div>
    `;
  }

  // ---- E. Atsakymai + eksportas ----
  function collectAnswers(){
    const result = {};
    document.querySelectorAll('.q[data-qid]').forEach(q => {
      const qid = q.getAttribute('data-qid');
      const checked = q.querySelector(`input[name="${CSS.escape(qid)}"]:checked`);
      result[qid] = checked ? Number(checked.value) : null;
    });
    return result;
  }
  function downloadJSON(filename, obj){
    const blob = new Blob([JSON.stringify(obj, null, 2)], { type:'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(a.href);
  }

  // ---- F. Init: bandome GLA.loadQuestions; jei nÄ—ra â€“ fallback ----
  async function init(){
    const { aid, role } = parseQuery();
    document.getElementById('aid').textContent = aid || 'â€”';
    document.getElementById('role').textContent = (role || 'self').toUpperCase();

    let questions = [];
    try {
      if (window.GLA && typeof GLA.loadQuestions === 'function') {
        const maybeData = await GLA.loadQuestions();
        // jeigu GLA.loadQuestions grÄ…Å¾ina jau masyvÄ… â€“ ok; jei objektÄ… â€“ normalizuojam
        questions = Array.isArray(maybeData) ? maybeData : normalizeQuestions(maybeData);
      } else {
        const data = await loadQuestionsDirect('bank/questions.json');
        questions = normalizeQuestions(data);
      }
    } catch(e) {
      console.error('Klaida Ä¯keliant klausimus:', e);
    }

    renderSurvey(questions);

    // Mygtukai
    document.getElementById('finish').addEventListener('click', () => {
      const answers = collectAnswers();
      const missing = Object.values(answers).filter(v => v == null).length;
      if (missing) {
        alert(`NeuÅ¾pildyti ${missing} teiginiai. UÅ¾pildykite visus.`);
        return;
      }
      const payload = {
        aid: aid || '(nenurodytas)',
        role: (role || 'self').toUpperCase(),
        ts: new Date().toISOString(),
        answers
      };
      const fname = `${(role || 'self').toUpperCase()}-${aid || 'AID'}.json`;
      downloadJSON(fname, payload);
    });

    document.getElementById('copy').addEventListener('click', () => {
      const payload = {
        aid: aid || '(nenurodytas)',
        role: (role || 'self').toUpperCase(),
        ts: new Date().toISOString(),
        answers: collectAnswers()
      };
      navigator.clipboard.writeText(JSON.stringify(payload, null, 2))
        .then(() => alert('JSON nukopijuotas Ä¯ iÅ¡karpinÄ™.'))
        .catch(() => alert('Nepavyko nukopijuoti.'));
    });
  }

  document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>

    let html = `<p><strong>Assessment ID:</strong> <code>${aid}</code></p>`;

    // SELF â€“ viena savivertinimo nuoroda
    const selfUrl = mk('self', 1);
    html += `<p>ğŸ“ Savivertinimo nuoroda (SELF): ${selfUrl}${selfUrl}</a></p>`;

    // Kitos grupÄ—s
    ['boss','peer','report','other'].forEach(role => {
      if(n[role] > 0){
        html += `<details open><summary>${role} (${n[role]})</summary><ol>`;
        for(let i=1; i<=n[role]; i++){
          const url = mk(role, i);
          html += `<li>${url}${url}</a></li>`;
        }
        html += `</ol></details>`;
      }
    });

    html += `<p class="muted">IÅ¡siÅ³skite Å¡ias nuorodas savo rateriams el. paÅ¡tu / Å¾inute. UÅ¾pildÄ™ jie atsisiÅ³s *.json ir atsiÅ³s jums.</p>`;
    linksBox.innerHTML = html;
  });
})();
</script>
</body>
</html>
